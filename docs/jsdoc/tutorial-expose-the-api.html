<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Tutorial: Expose the api - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="Api.html">Api</a></li><li><a href="Cache.html">Cache</a><ul class='methods'><li data-type='method'><a href="Cache.html#add">add</a></li><li data-type='method'><a href="Cache.html#get">get</a></li><li data-type='method'><a href="Cache.html#getKeys">getKeys</a></li><li data-type='method'><a href="Cache.html#purge">purge</a></li></ul></li><li><a href="CollectionApi.html">CollectionApi</a><ul class='methods'><li data-type='method'><a href="CollectionApi.html#count">count</a></li><li data-type='method'><a href="CollectionApi.html#del">del</a></li><li data-type='method'><a href="CollectionApi.html#get">get</a></li><li data-type='method'><a href="CollectionApi.html#post">post</a></li><li data-type='method'><a href="CollectionApi.html#put">put</a></li></ul></li><li><a href="Context.html">Context</a><ul class='methods'><li data-type='method'><a href="Context.html#changed">changed</a></li><li data-type='method'><a href="Context.html#done">done</a></li><li data-type='method'><a href="Context.html#error">error</a></li><li data-type='method'><a href="Context.html#hide">hide</a></li><li data-type='method'><a href="Context.html#validate">validate</a></li></ul></li><li><a href="CountOptionsProcessor.html">CountOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="CountOptionsProcessor.html#query">query</a></li></ul></li><li><a href="Database.html">Database</a><ul class='methods'><li data-type='method'><a href="Database.html#configure">configure</a></li><li data-type='method'><a href="Database.html#connect">connect</a></li><li data-type='method'><a href="Database.html#createApi">createApi</a></li><li data-type='method'><a href="Database.html#createStore">createStore</a></li><li data-type='method'><a href="Database.html#drop">drop</a></li><li data-type='method'><a href="Database.html#handle">handle</a></li></ul></li><li><a href="DatabaseConfigProcessor.html">DatabaseConfigProcessor</a><ul class='methods'><li data-type='method'><a href="DatabaseConfigProcessor.html#bind">bind</a></li><li data-type='method'><a href="DatabaseConfigProcessor.html#cache">cache</a></li><li data-type='method'><a href="DatabaseConfigProcessor.html#register">register</a></li></ul></li><li><a href="DelOptionsProcessor.html">DelOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="DelOptionsProcessor.html#query">query</a></li></ul></li><li><a href="Exception.html">Exception</a></li><li><a href="GetOptionsProcessor.html">GetOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="GetOptionsProcessor.html#cached">cached</a></li><li data-type='method'><a href="GetOptionsProcessor.html#fields">fields</a></li><li data-type='method'><a href="GetOptionsProcessor.html#options">options</a></li><li data-type='method'><a href="GetOptionsProcessor.html#query">query</a></li><li data-type='method'><a href="GetOptionsProcessor.html#single">single</a></li></ul></li><li><a href="PostOptionsProcessor.html">PostOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="PostOptionsProcessor.html#data">data</a></li></ul></li><li><a href="PutOptionsProcessor.html">PutOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="PutOptionsProcessor.html#data">data</a></li><li data-type='method'><a href="PutOptionsProcessor.html#query">query</a></li></ul></li><li><a href="ReadOptionsProcessor.html">ReadOptionsProcessor</a><ul class='methods'><li data-type='method'><a href="ReadOptionsProcessor.html#fields">fields</a></li><li data-type='method'><a href="ReadOptionsProcessor.html#options">options</a></li><li data-type='method'><a href="ReadOptionsProcessor.html#query">query</a></li></ul></li><li><a href="Store.html">Store</a><ul class='methods'><li data-type='method'><a href="Store.html#count">count</a></li><li data-type='method'><a href="Store.html#del">del</a></li><li data-type='method'><a href="Store.html#get">get</a></li><li data-type='method'><a href="Store.html#getCollection">getCollection</a></li><li data-type='method'><a href="Store.html#post">post</a></li><li data-type='method'><a href="Store.html#put">put</a></li><li data-type='method'><a href="Store.html#read">read</a></li></ul></li></ul><h3>Modules</h3><ul><li><a href="module-mongodb-proxy.html">mongodb-proxy</a><ul class='methods'><li data-type='method'><a href="module-mongodb-proxy.html#.create">create</a></li></ul></li></ul><h3>Tutorials</h3><ul><li><a href="tutorial-bind-global-events.html">Bind global events</a></li><li><a href="tutorial-expose-the-api.html">Expose the api</a></li><li><a href="tutorial-getting-started.html">Getting started</a></li><li><a href="tutorial-register-collection.html">Register a collection</a></li><li><a href="tutorial-set-cache.html">Set cache provider</a></li><li><a href="tutorial-using-mongodb-driver.html">Using the mongodb driver</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">Tutorial: Expose the api</h1>
    

    <section>

<header>
    

    <h2>Expose the api</h2>
</header>

<article>
    <p>A nice use of this proxy, is that it has an easy to use and easy to be serialized api syntax.<br />
This api can be exposed to REST services in a few steps.
</p>
<p>The database instance, provides a handle method that received a request and resolved its requested data. The api syntax is as follows:</p>
<div class="list-group">
    <p class="list-group-item-text"><b>fetching all entries</b><br />GET /users</p>
    <p class="list-group-item-text"><b>fetching a single entry</b><br />GET /users/56802653a5261282c30acc28</p>
    <p class="list-group-item-text"><b>fetching with a query</b><br />GET /users?q= + encodeStringified({firstName:'John'})</p>    
    <p class="list-group-item-text"><b>fetching the count for the query</b><br />GET /users/count?q= + encodeStringified({firstName:'John'}) </p>
    <p class="list-group-item-text"><b>posting data (with form data)</b><br />POST /users</p>
    <p class="list-group-item-text"><b>updating an entry (with form data)</b><br />PUT /users/56802653a5261282c30acc28</p>
    <p class="list-group-item-text"><b>deleting an entry</b><br />DEL /users/56802653a5261282c30acc28 </p>
</div>
<br />
<p>Here, as an example, we will achive this with the expressJs routing system</p>

<pre class="prettyprint">
        
    var express = require('express');
    var <a href="module-mongodb-proxy.html">dbproxy</a> = require('mongodb-proxy');        
         
    var app = express();
    var <a href="Database.html">db</a> = dbproxy.<a href="module-mongodb-proxy.html#create">create</a>({...});
        
    // listen for all requests under an '/api' location 
    app.all('/api/:collection*', function (req, res, next) {    
        // prepare an info object for the routing function     
        var route = {
            method: req.method,
            collection: req.params.collection,
            path: req._parsedUrl.pathname.substring('/api/'.length + req.params.collection.length),
            query: req.query.q,
            data: req.body,
            req: req,
            res: res
        };
        
        // get the post data 
        var postdata = "";        
        req.on('data', function (postdataChunk) {
            postdata += postdataChunk;
        });  
        
        req.on('end', function () {
            var jsonData = JSON.parse(postdata || '{}');
            route.data = jsonData;
            
            // pass the work on the proxy 
            db.<a href="Database.html#handle">handle</a>(route, next, function (error, results) {
                if (error) {
                    if (typeof (error) === 'object') {
                        if (error.code && error.messages) {
                            res.status(error.code).send(error.messages);
                        }
                        else {
                            res.status(500).send(error.message);
                        }
                    }
                    else {
                        res.status(500).send(error);
                    }
                }
                else {
                    res.send(results);
                }
            });
        });
    });
    
    app.listen(3000);
        
</pre>

<h4>Consuming the api with jQuery</h4>
<pre class="prettyprint">
    
    // posting 
    $.ajax({
        url: "/api/users",
        type: 'POST',
        dataType: 'json',
        data: JSON.stringify({
            firstName: 'John',
            lastName: 'Smith',
            password: 'test'
        })
    }).error(function (err) {
        throw err;
    }).done(function (results) {
        console.log(results);
    });
    
    // reading 
    $.ajax({
        url: "/api/users?q=" + encodeURIComponent(JSON.stringify({
            id: 'xx',
            $fields: ['firstName'],
            $options: {
                limit: 2
            },
            $single: true,
            $cached: true
        })),
    }).error(function (err) {
        throw err;
    }).done(function (results) {
        console.log(results);
    });
    
    // updating 
    $.ajax({
        url: "/api/users?q=" + encodeURIComponent(JSON.stringify({
            id: 'xx'
        })),
        type: 'PUT',
        dataType: 'json',
        data: JSON.stringify({
            lastName: 'Something else'
        })
    }).error(function (err) {
        throw err;
    }).done(function (results) {
        console.log(results);
    });
    
    // deleting 
    $.ajax({
        url: "/api/users?q=" + encodeURIComponent(JSON.stringify({
            id: 'xx'
        })),
        type: 'DELETE',
        dataType: 'json'
    }).error(function (err) {
        throw err;
    }).done(function (results) {
        console.log(results);
    });
    
    // counting 
    $.ajax({
        url: "/api/users/count?q=" + encodeURIComponent(JSON.stringify({
            firstName: 'John'
        })),
        type: 'GET',
        dataType: 'json'
    }).error(function (err) {
        throw err;
    }).done(function (results) {
        console.log(results);
    });
    
</pre>


</article>

</section>

</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>